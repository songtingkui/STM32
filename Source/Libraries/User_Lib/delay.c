/*********************************************************************************************************
* 模块名称：delay.c
* 
* 摘    要：延时函数库（使用指令延时）
* 
* 当前版本：1.0.0
* 
* 作    者：ZLGCX(COPYRIGHT 2021 - 2030 ZLGCX. All rights reserved.)
* 
* 完成日期：2021年05月11日 
* 
* 内    容：毫秒级延时
*			
* 注    意：
*                                                                 
**********************************************************************************************************
* 取代版本：
* 
* 作    者： 
* 
* 完成日期：
* 
* 修改内容：
* 
* 修改文件：
*********************************************************************************************************/


/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include "hk32f030m.h"

#include "delay.h"

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              全局变量
*********************************************************************************************************/
 uint32_t g_u32_1msTick = 0;                     							    
/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/
 

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/


/*********************************************************************************************************
*                                              API函数实现
*********************************************************************************************************/

/*********************************************************************************************************
* 函数名称：void delay_init(void)
* 
* 函数功能：初始化SysTick计数器，主时钟8分频，关闭状态
* 
* 输入参数：
* 输出参数：
* 返 回 值：
* 
* 创建日期：2021年05月10日
* 
* 注    意：
* 修改记录：
*********************************************************************************************************/
void SysTick_Initialize(void)
{
	// 关闭计数器 & (HCLK/8)
	SysTick->CTRL = 0;
}

/*********************************************************************************************************
* 函数名称：void delay_tick(uint32_t tick)
* 
* 函数功能：微秒级延时
* 
* 输入参数：tick = 要延时的SysTick时钟数，最大计数值：16,777,215
* 输出参数：None
* 返 回 值：None
* 
* 创建日期：2021年05月10日
* 
* 注    意：SysTick计数器修改：主时钟8分频，使用后关闭
* 
* 修改记录：
*********************************************************************************************************/
void delay_tick(uint32_t tick)
{
	/* Check the parameters */
	assert_param(tick <= 16777215UL);

	// 清除计数标志
	SysTick->CTRL = 0;
	SysTick->VAL  = 0;
	SysTick->LOAD = tick;
	
	// 判断是否计数完毕
	SysTick->CTRL |= SysTick_CTRL_ENABLE_Msk;	
	while (!(SysTick->CTRL & SysTick_CTRL_COUNTFLAG_Msk));
	SysTick->CTRL  = 0;
}
/*********************************************************************************************************
* 函数名称：void SysTick_Handler(void)
* 
* 函数功能：SYSTICK中断1ms计数器
* 
* 输入参数：None
* 输出参数：None
* 返 回 值：0
* 
* 创建日期：2021年05月10日
* 
* 注    意：SYSTICK的时钟固定为HCLK时钟的1/8，即SYSTICK=SYSCLK/8
			SYSCLK:系统时钟
* 修改记录：
*********************************************************************************************************/
void TIM6_IRQHandler(void)
{	
	if (TIM_GetITStatus(TIM6, TIM_IT_Update) != RESET)
    {
		g_u32_1msTick ++;		
		TIM_ClearITPendingBit(TIM6, TIM_IT_Update);		
    }
	
}

